<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ColabFold - Protein Structure Prediction</title>
    <link rel="stylesheet" href="../styles/styles.css">
    <script src="../components/component-loader.js"></script>
</head>
<body>
    <!-- Header Container -->
    <div id="header-container"></div>

    <!-- Navigation Bar Container -->
    <div id="navbar-container"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar Container -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <div class="main-content">
            <a href="../index.html" class="back-button">‚Üê Back to Home</a>
            
            <div class="content-header">
                <h1>ColabFold - Protein Structure Prediction</h1>
            </div>

            <div class="server-status-container">
                <span id="colabfold-queue-status" class="status-pill badge-checking">ColabFold Queue Status: Checking...</span>
                <span class="tooltip-container">
                    <span class="tooltip-icon">?</span>
                    <span class="tooltip-text">ColabFold Server Load - Time to Start Job <br> Idle (1-20 minutes), Moderate (20-40 minutes), Busy (40+ minutes)</span>
                </span>
            </div>
            <div class="tool-description">
                <h3>How to use:</h3>
                <br/>
                <ol>
                    <li>Choose your input method: paste sequence text or upload a FASTA file</li>
                    <li>Provide your protein sequence(s):
                        <ul>
                            <li><strong>Paste Sequence:</strong> Copy and paste your protein sequence(s) in FASTA format</li>
                            <li><strong>Upload File:</strong> Select a FASTA file (.fasta, .fa) from your computer</li>
                        </ul>
                    </li>
                    <li>Choose appropriate model settings (default values work well for most cases)</li>
                    <li>Click "Submit Job" to start the prediction</li>
                    <li>You will receive a job ID to track your submission</li>
                    <li>Results will be available for download once the job completes</li>
                    <li>Typcially, a job for ~2000 residues will complete within (queue load time) + (5-30 minutes).
                        <span class="tooltip-container">
                            <span class="tooltip-icon">?</span>
                            <span class="tooltip-text">Refer to ColabFold Queue Load above.</span>
                        </span>
                    </li>
                    
                </ol>
            </div>

            <div class="input-form">
                <h3>Submit Protein Sequence for Structure Prediction</h3>
                <form id="colabfold-form">
                    <div class="form-group">
                        <label for="input-method">Input Method:</label>
                        <select id="input-method" name="input-method" onchange="toggleInputMethod()">
                            <option value="paste">Paste Sequence</option>
                            <option value="file">Upload FASTA File</option>
                        </select>
                    </div>

                    <div class="form-group" id="sequence-group">
                        <label for="sequence">Protein Sequence (FASTA format):</label>
                        <textarea 
                            id="sequence" 
                            name="sequence" 
                            placeholder=">sequence_id
MKTVRQERLKSIVRILERSKEPVSGAQLAEELSVSRQVIVQDIAYLRSLGYNIVATPRGYVLAGG
DKHSDYIKALDGRGVSDEMSHRAGDVLTLLTTTSLGGQYPLTYMNPGSRYQEPKKDTRVDVKTA
EGLDVQFNLRQHPETLPRTVHPHPNPVQEIHQPLDQYIYPYSLPQAGLLGKVKDLDLVMSHHP" 
                            required></textarea>
                        <small>Paste your protein sequence(s) in FASTA format</small>
                    </div>

                    <div class="form-group" id="file-group" style="display: none;">
                        <label for="fasta-file">FASTA File:</label>
                        <input type="file" id="fasta-file" name="fasta-file" accept=".fasta,.fa,.fas,.txt">
                        <small>Upload a FASTA file containing protein sequence(s)</small>
                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #28a745;">
                            <strong>üìÅ Example files:</strong><br>
                            ‚Ä¢ <a href="https://www.rcsb.org/fasta/entry/6M0J" target="_blank" rel="noopener">SARS-CoV-2 Spike Protein RBD + ACE2 (PDB: 6M0J)</a><br>
                            ‚Ä¢ <a href="https://www.rcsb.org/fasta/entry/7CWM" target="_blank" rel="noopener">SARS-CoV-2 Spike Protein Wuhan Variant (PDB: 7CWM)</a><br>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="job-name">Job Name (optional):</label>
                        <input type="text" id="job-name" name="job-name" placeholder="sequence_id_prediction">
                    </div>

                    <div class="form-group">
                        <label for="model-type">
                            Model Type:
                            <span class="tooltip-container">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">
                                    <strong>AlphaFold2 + ptm</strong>
                                    <br/>Predicts a single protein structure, using a quality metric (ptm) for better confidence scoring.
                                    <br/><strong>AlphaFold2 multimer v3</strong>
                                    <br/>Predicts a protein complex structure, with improved accuracy for complex interactions.
                            </span>
                        </label>
                        <select id="model-type" name="model-type">
                            <option value="auto">Auto</option>
                            <option value="alphafold2_ptm">AlphaFold2 + ptm</option>
                            <option value="alphafold2_multimer_v3">AlphaFold2 multimer v3</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="num-recycles">
                            Number of recycles:
                            <span class="tooltip-container">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Number of recycles to perform. More recycles = more accurate but slower.</span>
                            </span>
                        </label>
                        <select id="num-recycles" name="num-recycles">
                            <option value="auto">Auto</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="max-seq">
                            Max sequence clusters:
                            <span class="tooltip-container">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Maximum number of sequence clusters to use in the Multiple Sequence Alignment. Higher numbers = more accurate but slower.</span>
                            </span>
                        </label>
                        <select id="max-seq" name="max-seq">
                            <option value="auto">Auto</option>
                            <option value="16">16 (fastest)</option>
                            <option value="32">32</option>
                            <option value="64">64</option>
                            <option value="128">128 (default)</option>
                            <option value="256">256</option>
                            <option value="512">512 (most accurate)</option>
                        </select>
                    </div>

                    <div class="form-group disabled">
                        <label for="max-extra-seq">
                            Max extra sequences:
                            <span class="tooltip-container">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Maximum number of extra sequences to include in the Multiple Sequence Alignment. Typically set to 2x the max sequence clusters.</span>
                            </span>
                        </label>
                        <select id="max-extra-seq" name="max-extra-seq" class="disabled">
                            <option value="auto">Auto</option>
                            <option value="32">32 (fastest)</option>
                            <option value="64">64</option>
                            <option value="128">128</option>
                            <option value="256">256 (default)</option>
                            <option value="512">512</option>
                            <option value="1024">1024 (most accurate)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="num-models">
                            Number of models:
                            <span class="tooltip-container">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Number of different 3D structure models to generate. More models provide confidence estimates but take longer.</span>
                            </span>
                        </label>
                        <select id="num-models" name="num-models">
                            <option value="1">1</option>
                            <option value="3">3</option>
                            <option value="5" selected>5 (recommended)</option>
                        </select>
                    </div>

                    <button type="submit" class="submit-button">Submit Job</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Load required services -->
    <script src="../services/api-service.js"></script>
    <script src="../services/protein-tools-service.js"></script>
    <script src="../scripts/ping.js"></script>
    <script src="../scripts/colabfold.js"></script>
</body>
</html>